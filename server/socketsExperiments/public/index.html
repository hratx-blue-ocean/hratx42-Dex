<html>
<body>
    <h4>websocket</h4>
    <select id="group">
        <option>group 1</option>
        <option>group 2</option>
        <option>group 3</option>
        <option>group 4</option>
    </select>
    <!-- <h5>Group: <span id="group">darwin</span></h5> -->
    <!-- a hardoced group name -->
    <button onclick="bjoin();">join group</button><br>
    <input id="text" type="text"/>
    <span id="out"></span>
    <script>
        var group=document.getElementById("group").value;
        var ws=new  WebSocket('ws://localhost:5000');
        ws.onerror=function(e){out.innerHTML=e;}
        ws.onclose=function(e){out.innerHTML='closed'+e;}
        ws.onopen=function(){
            out.innerHTML='connected ';
        }
        ws.onmessage=function(message){
            // const message = JSON.parse(messageJSON);
            const messageData = JSON.parse(message.data);
            if (messageData.msg && messageData.msg === 'connected'){
                console.log('connected!');
                bjoin()
            }else{
                out.innerHTML += message.data + '<br>';
            }
        }
        function send(msg){
            ws.send(JSON.stringify({msg:msg}));
        }
        function broadcast(msg,room){
            ws.send(JSON.stringify({room:room,msg:msg}))
        }
        function join(room){
            ws.send(JSON.stringify({join:room}));
        }
        function bjoin(){
            group=document.getElementById("group").value;
            join(group);
        }
        text.onchange=function(el){
            //alert(el.target.value);
            broadcast(el.target.value,group);
        }
    </script>
</body>